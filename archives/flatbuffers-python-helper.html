<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><title> FlatBuffers : 用于生成cxx的python脚本 · 愤怒的泡面</title><meta name="description" content="FlatBuffers : 用于生成cxx的python脚本 - AngryPowman"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/prontera.css"><link rel="search" type="application/opensearchdescription+xml" href="https://powman.org/atom.xml" title="愤怒的泡面"></head><body><header class="feature-header"><nav class="component-nav"><ul><div class="logo-container"><a href="/"><h2 class="title">愤怒的泡面</h2></a></div><a href="/" target="_self" class="li component-nav-item"><p>主页</p></a><a href="/archives" target="_self" class="li component-nav-item"><p>归档</p></a><a href="/feedback" target="_self" class="li component-nav-item"><p>留言板</p></a><a href="/about" target="_self" class="li component-nav-item"><p>关于我</p></a><ul class="shortcut-icons"><a href="https://github.com/AngryPowman" target="_blank"><img src="/images/github.svg" class="icon"></a><a href="https://www.zhihu.com/people/AngryPowman" target="_blank"><img src="/images/zhihu.svg" class="icon"></a><a href="/atom.xml" target="_blank"><img src="/images/rss.svg" class="icon"></a></ul></ul></nav></header><main class="container"><div id="post-container"><div class="post"><article class="post-block"><h1 class="post-title">FlatBuffers : 用于生成cxx的python脚本</h1><div class="post-info">Jul 8, 2014</div><div class="post-content"><p>Flatbuffers的编译器有个-c参数选项，这个选项需要一个个传入<em>.fbs文件的路径，给维护带来很大的不便。昨晚改了下flatbuffers的编译器代码，把cpp代码生成器生成的部分变量名以及生成的cxx文件后缀改掉了，这样看起来违和感没那么强，符合Coeus的代码风格。本来也想把-c选项改成支持’</em>‘通配符的，这样便可以肆无忌惮地给出一个目录让编译器自己去遍历.fbs文件。但回头一想这似乎不应该是编译器做的事情，所以就把这个想法搁掉了。于是写了个简单的python脚本(2.7.x)，用来维护fbs文件并且把生成的cxx文件输出到指定目录。<br><a id="more"></a></p>
<p>代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">#Author By AngryPowman</span><br><span class="line">#Copyright 2014 Coeus</span><br><span class="line"></span><br><span class="line">import os</span><br><span class="line">import glob</span><br><span class="line"></span><br><span class="line">FBS_COMPILER = os.path.abspath(&amp;quot;./tools/flatc.exe&amp;quot;)</span><br><span class="line">FBS_PATH = &amp;quot;./fbs/*.fbs&amp;quot;</span><br><span class="line">FBS_CXX_OUTPUT = &amp;quot;./protocol/&amp;quot;</span><br><span class="line">FBS_FILES = &apos;&apos;</span><br><span class="line"></span><br><span class="line">def search(path) :</span><br><span class="line">	global FBS_FILES</span><br><span class="line">	for filename in glob.glob(path):</span><br><span class="line">		if os.path.isdir(filename):</span><br><span class="line">			search(filename)</span><br><span class="line">		else:</span><br><span class="line">			base_file_name = os.path.basename(filename)</span><br><span class="line">			FBS_FILES += filename + &apos; &apos;</span><br><span class="line">			print filename</span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">	#search files</span><br><span class="line">	search(FBS_PATH)</span><br><span class="line">	#compile</span><br><span class="line">	print &amp;quot;FBS Environment :&amp;quot;</span><br><span class="line">	print &amp;quot;		&amp;gt;&amp;gt; FBS_COMPILER : &amp;quot; + FBS_COMPILER</span><br><span class="line">	print &amp;quot;		&amp;gt;&amp;gt; FBS_PATH : &amp;quot; + FBS_PATH</span><br><span class="line">	print &amp;quot;		&amp;gt;&amp;gt; FBS_CXX_OUTPUT : &amp;quot; + FBS_CXX_OUTPUT</span><br><span class="line">	print &amp;quot;		&amp;gt;&amp;gt; FBS_FILES : &amp;quot; + FBS_FILES</span><br><span class="line"></span><br><span class="line">	#create output directory if not exists</span><br><span class="line">	if not os.path.exists(FBS_CXX_OUTPUT):</span><br><span class="line">		os.makedirs(FBS_CXX_OUTPUT)</span><br><span class="line"></span><br><span class="line">	result = os.system(FBS_COMPILER + &amp;quot; -o &amp;quot; +FBS_CXX_OUTPUT + &amp;quot; -c &amp;quot; + FBS_FILES)</span><br><span class="line">	if result == 0:</span><br><span class="line">		print &amp;quot;Compiled Okay!&amp;quot;</span><br><span class="line">	else:</span><br><span class="line">		print &amp;quot;Failed to compile, errorcode = &amp;quot; + str(result)</span><br></pre></td></tr></table></figure>
<p>相关的环境变量都在最顶部定义，没啥版权，可以按需修改：）</p>
</div></article></div><div id="disqus_thread"></div></div><script>var disqus_shortname = 'angrypowman';
var disqus_identifier = 'archives/flatbuffers-python-helper.html';
var disqus_title = 'FlatBuffers : 用于生成cxx的python脚本';
var disqus_url = 'https://powman.org/archives/flatbuffers-python-helper.html';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//angrypowman.disqus.com/count.js" async></script></main><footer class="footer-container"><div class="paginator"><a href="/archives/tcp-prof-3.html" class="prev">PREV</a><a href="/archives/md-schemas.html" class="next">NEXT</a></div><div class="copyright"><p>© 2017 - 2018 <a href="https://powman.org">AngryPowman</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/AngryPowman/hexo-theme-prontera" target="_blank">hexo-theme-prontera</a>.</p></div></footer><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-93668618-1",'auto');ga('send','pageview');</script></body></html>